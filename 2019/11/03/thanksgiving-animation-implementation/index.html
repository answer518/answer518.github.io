
<!DOCTYPE html>
<html lang="">


<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#202020" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <script
    type='text/javascript'>var TINGYUN = function (t, e, n) {
        if (/(MSIE [0-8].\d+)/.test(navigator.userAgent)) { return { TY_INFO: 'Browser Version Not Support to load TINGYUN Agent' }; } function r(t) { return JSON.parse(t) } function i(t) { return JSON.stringify(t) } function a(t) { var e = !!t && "length" in t && t.length, n = typeof t; return "function" !== n && ("array" === n || 0 === e || "number" == typeof e && e > 0 && e - 1 in t) } function o(t, e, n) { var r, i = 0; if (t) if (a(t)) for (r = t.length; i < r && e.call(t[i], t[i], i) !== !1; i++); else for (i in t) if ((n || Object.prototype.hasOwnProperty.call(t, i)) && e.call(t[i], t[i], i) === !1) break; return t } function s(t) { return function (e) { return "Array" === t && Array.isArray ? Array.isArray(e) : Object.prototype.toString.call(e) === "[object " + t + "]" } } function u(t) { return new Function("return " + t)() } function c(t) { switch (typeof t) { case "object": if (!t) return null; if (t instanceof Array) { var e = Pe.call(t); return o(e, function (t, n) { e[n] = c(t) }), "[" + e.join(",") + "]" } if (t instanceof Date) return t.getTime().toString(); var n = ""; return o(t, function (t, e) { He(t) || (n += c(e) + ":" + c(t) + ",") }), n && (n = n.substr(0, n.length - 1)), "{" + n + "}"; case "string": return Ue + t.replace(Fe, "\\$1").replace(Xe, "\\n") + Ue; case "number": return isNaN(t) ? null : t; case "boolean": return t; case "function": return c(t.toString()); case "undefined": default: return '"undefined"' } } function f(t) { return t && Ne(t) ? qe(t) : t } function l(t, e, n, r) { return t.addEventListener(e, n, r) } function d(t, e, n) { return t.removeEventListener(e, n) } function h(t, e, n) { return t.attachEvent("on" + e, n) } function v(t, e, n) { return t.detachEvent("on" + e, n) } function p(t, e, n, r) { var i = function () { return We(t, e, i), n.apply(this, arguments) }; return Ye(t, e, i, r) } function g(t, e) { return Function.prototype.apply.apply(t, e) } function m(t, e) { return function () { t.apply(e, arguments) } } function y(t) { return Je ? Je(t) : t } function _(t) { var e = arguments.length; if (e < 2 || !t) return t; var n = Pe.call(arguments, 1); return o(n, function (e) { o(e, function (e, n) { t[n] = e }) }), t } function x(t, e) { for (var n = -1, r = 0, i = null == t ? 0 : t.length, a = []; ++n < i;) { var o = t[n]; e(o, n, t) && (a[r++] = o) } return a } function b(t, e) { return t ? e ? t.replace(/\{(\w+.?\w+)\}/g, function (t, n) { return e[n] || "" }).replace(/\{(\d+)\}/g, function (t, n) { return e[n] || "" }) : t : "" } function S(t, e, n) { var r; if (null == t) return -1; var i = Object(t), a = i.length >>> 0; if (0 === a) return -1; var o = +n || 0; if (Math.abs(o) === 1 / 0 && (o = 0), o >= a) return -1; for (r = Math.max(o >= 0 ? o : a - Math.abs(o), 0); r < a;) { if (r in i && i[r] === e) return r; r++ } return -1 } function E(t, e) { var n = null == t ? 0 : t.length; if (!n) return -1; for (var r = n; r--;)if (t[r] === e) return r; return r } function w(t) { return setTimeout(t, 0) } function T() { } function k() { var t = window && window.performance; return t && t.timing && t.timing.navigationStart && t.now ? Math.round(t.timing.navigationStart + t.now()) : +new Date } function C(t) { return function () { if (null !== t) { var e = t; t = null, e.apply(this, arguments) } } } function O(t) { return t ? Ne(t) ? t.length : e.ArrayBuffer && t instanceof ArrayBuffer ? t.byteLength : e.Blob && t instanceof Blob ? t.size : t.length ? t.length : 0 : 0 } function I(t) { return Ke !== Ve && /^https/i.test(t && t.protocol || Ke) ? "https:" : Ve } function R(t, e, n, r) { var i = null; return t && e && (i = I(r) + "//" + t + e, n && (i += "?", o(n, function (t, e) { var n = [y(e), "=", y(t), "&"]; i += n.join("") }), r && r.disableUploadTime || (i += "__r=" + k()))), i } function q() { this.events = {} } function M(t) { return !(t in Xn) || Xn[t] } function N(t) { var e = Pn.cookie.match(new RegExp("(^|;\\s*)(" + t + ")=([^;]*)")); return e ? e[3] : null } function A(t, e, n, r) { var i = t + "=" + e; if (n) { var a = new Date; a.setTime(a.getTime() + 1e3 * n), i += ";expires=" + a.toGMTString() } r && (i += ";path=" + r), Pn.cookie = i } function H(t, e, n, r) { He(n) && (r = n); var i = new XDomainRequest; i.open(ir, t), i.onload = function () { r(null, i.responseText) }, i.onerror = function (t) { r(t) }, i.send(Me(e)) } function j(t, e, n) { var r = Pn.createElement(t); try { for (var i in e) r[i] = e[i] } catch (a) { var o = "<" + t; for (var i in e) o += " " + i + '="' + e[i] + '"'; o += ">", n || (o += "</" + t + ">"), r = Pn.createElement(o) } return r } function D(t, e, n, r) { He(n) && (r = n); var i = "ty_form" + k(), a = j("div", { style: rr }), o = j("iframe", { name: i, width: 0, height: 0, style: rr }), s = j("form", { style: rr, action: t, enctype: "application/x-www-form-urlencoded", method: "post", target: i }), u = j("input", { name: "data", type: "hidden" }, !0); u.value = Me(e), s.appendChild(u), a.appendChild(o), a.appendChild(s), Pn.body.appendChild(a), s.submit(), o.onload = function () { r && r(null, o.innerHTML), Pn.body.removeChild(a) } } function L(t, e, n, r) { He(n) && (r = n, n = null); var i = C(r), a = new Un; a[vn] = !0, a.overrideMimeType && a.overrideMimeType("text/html"), a.onreadystatechange = function () { 4 == a.readyState && 200 == a.status && i(null, a.responseText) }, a.onerror = i, e = Me(e); try { a.open(ir, t, !0) } catch (o) { return D(t, e, i) } for (var s in n) a.setRequestHeader(s, n[s]); e ? a.send(e) : a.send() } function B(t, e, n, r) { He(n) && (r = n, n = null); var i = $n.sendBeacon(t, Me(e)); i ? r && r() : L(t, e, n, r) } function z(t, e, n) { if (t && n && He(n)) { var r = t[e]; if (!r || !r._wrapped) { var i = n(r, e); return i && (i._wrapped = !0), t[e] = i, i } } } function P(t) { sr && t() } function U(t) { return function () { sr && t.apply(this, arguments) } } function F() { sr = !1 } function X(t, e) { pr[t] = e } function G(t) { W(t, _r) } function Y(t) { W(t, xr) } function W(t, e) { var n = "ok"; return t ? void e.push(t) : n = e.length ? e.join("\n") : n } function J(t) { try { return f(t) } catch (e) { G(e && e.message) } return null } function $(t, e, n) { return n === _n && t && t.getResponseHeader ? t.getResponseHeader(e) : n === xn && t.headers ? t.headers.get(e) : null } function K(t, e, n) { var r = J($(t, yn, n || _n)); return r && r.r && toString(r.r) === toString(e.r) ? r : null } function V(t, e) { t.s_id = e.id, t.s_name = e.action, e.time && (t.s_du = e.time.duration, t.s_qu = e.time.qu), t.t_id = e.trId } function Q(t) { var e = !1; return o(dr.xhrs, function (n) { if (n.id === t.id) return e = !0, !1 }), e } function Z() { try { o(gr, function (t) { t && t.disconnect() }) } catch (t) { } } function tt(t, e) { this.flags = 0, He(t.create) && (this.create = t.create, this.flags |= Tr), He(t.before) && (this.before = t.before, this.flags |= kr), He(t.after) && (this.after = t.after, this.flags |= Cr), He(t.error) && (this.error = t.error, this.flags |= Or), this.data = e } function et(t, e) { if (!Rr) { if (!je(t) || !t) throw new TypeError("callbacks arguments must be an object"); return Rr = new tt(t, e) } } function nt(t) { var e = Rr.data; if (0 !== (Rr.flags & Tr)) { var n = Rr.create(Rr.data); void 0 !== n && (e = n) } return function r() { 0 !== (Rr.flags & kr) && Rr.before(this, e); var n = r; n._ && (n._ = 1); try { var i = t.apply(this, arguments) } catch (a) { throw 0 !== (Rr.flags & Or) && Rr.error(e, a), a } return 0 !== (Rr.flags & Cr) && Rr.after(this, e), i } } function rt(t) { return !Rr || Rr.flags <= 0 ? t : nt(t) } function it() { function t(t) { return function (e) { var n = Pe.call(arguments, 0); He(e) && (n[0] = rt(e)); var r = this; try { return t.apply(r, n) } catch (i) { } return g(t, [r, n]) } } z(e, "setTimeout", t), z(e, "setInterval", t) } function at(t) { function e() { } return e.prototype = t, new e } function ot() { this.id = null, this.active = null, this._set = [] } function st() { it(); var t = new ot; return t.id = et({ create: function () { return t.active }, before: function (e, n) { n && t.enter(n) }, after: function (e, n) { n && t.exit(n) }, error: function (e, n) { if (e) { try { var r = "moduleId"; n[r] = e[r] } catch (i) { } t.exit(e) } } }), t } function ut() { return Mr || (qr = st(), Mr = !0), qr } function ct(t) { Nr && console.warn(t || "Event key required!") } function ft(t) { t = t || {}, this.key = t.key, this.type = t.type || qn; var e = t.timeout || 6e5; this.i = e ? setTimeout(m(this.fail, this), e) : null, this.status = 1, this.remain = 0, this.xhrs = [], this.s = k(), this.e = null, this.called = this.sent = this.stored = !1 } function lt(t) { t = t || {}; var e = t.key; if (!e) return new ct; if (jr[e]) return new ct("event " + e + " is executing"); jr[e] = !0; var n = qr.createContext(); qr.enter(n); var r = new ft(t); return qr.set("event", r), r._end = function () { var t = this; t.sent || t.stored || 0 !== t.remain || !t.called ? t.stored && this.refreshEventAndStore(n) : t.finish().send(n) }, r.end = function (t, e) { var r = this; return r.called ? void (Nr && console.warn("Event " + this.key + "has ended or failed!")) : (r.called = !0, qr.exit(n), r.status = null != t ? t : 1, void (e || r._end())) }, r.finish = function (t) { var e = this; return e.e = k(), e.i && clearTimeout(e.i), delete jr[e.key], e }, r.fail = function () { this.end(0) }, r.store = function () { this.end(null, !0), this.refreshEventAndStore(n), this.stored = !0 }, r } function dt(t) { var n = e.localStorage.getItem(On), r = J(n); if (r && r.start && (t = t || {}, !t.key || r.key === t.key)) { var i = t.timeout; if (i || (i = In), r.duration = k() - r.start, r.duration > i) return void e.localStorage.removeItem(On); if (hr.xhrs && hr.xhrs.length > 0) { r.xhrs || (r.xhrs = []); try { o(hr.xhrs, function (t) { t.start = t.start - r.start }), r.xhrs = r.xhrs.concat(hr.xhrs) } catch (a) { } pt() } var s = e.performance.timing; if (s.navigationStart && (s.loadEventEnd || s.loadEventStart) && s.navigationStart - r.start >= 0) { var u = { req: "GET " + document.URL, status: 200, type: "PF", start: s.navigationStart - r.start, du: (s.loadEventEnd || s.loadEventStart) - s.navigationStart }; ei && (u.s_id = ei.id, u.s_name = ei.n, u.s_du = ei.a, u.s_qu = ei.q, u.t_id = ei.tid), r.xhrs || (r.xhrs = []), r.xhrs.push(u) } var c = 1; t.status && (c = t.status === Nn ? 1 : 0), r.status = c, e.localStorage.removeItem(On), oi.emit("send", "/spe", null, r, T) } } function ht(t) { w(function () { dt(t) }) } function vt() { var t = e.localStorage.getItem(On); t && (hr.recording = !0) } function pt() { hr.recording = !1, hr.xhrs = [] } function gt(t) { t = _(t || {}, { type: Rn }); var e = lt(t); return t.autoEnd && setTimeout(function () { t.status && t.status === An ? e.fail() : e.end() }, t.endDelay || Mn), e } function mt() { return oi[zr] || oi._end } function yt() { return oi.loadEventEnd || oi._end } function _t(t) { function e(e) { return t[e] > 0 ? t[e] - i : 0 } var r = {}, i = n; if (t) { P(function () { var e = ur.t = {}; o(t, function (t, n) { He(t) || (e[n] = t) }, !0) }), i = t.navigationStart, r = { f: e(Jr), qs: e(Dr), rs: e(Lr), re: e(Br), os: e(zr), oe: e(Pr), oi: e(Ur), oc: e(Fr), ls: e(Xr), le: e(Gr), tus: e(Yr), tue: e(Wr) }; var a = e(Jr), s = e($r), u = e(Kr), c = e(Vr), f = e(Qr), l = e(Zr); if (l - f > 0 && (r.cs = f, r.ce = l), s - a > 0 && (r.ds = a, r.de = s), (c - u > 0 || c > 0) && (r.es = u, r.ee = c), 0 == r.le) { var d = yt(); r.ue = d - i } oi._le = r.ue || r.le; var h; t.msFirstPaint && (h = t.msFirstPaint, P(function () { ur.fp = "m_" + h }), r.__fp = 3), h && (r.fp = Math.round(h - i), oi.fp = r.fp), t[ti] && (r.sl = e(ti)) } else r = { t: i, os: mt() - i, ls: yt() - i }; return r.je = oi.errs && oi.errs.length || 0, oi.ct && (r.ct = oi.ct - i), oi.touch && (r.fi = oi.touch - i), r } function xt(t, e) { var r = { tr: !1, tt: y(Pn.title), charset: Pn.characterSet }; cr.resources && _(r, cr.resources), P(function () { r.debug = ur }), F(); var i = oi.errs; o(i, function (t, r) { var a = t.toObject(); a.o = a.o - e && e.navigationStart || n, i[r] = a }), r.err = i; var a, s = "getEntriesByType"; return t[s] ? a = t[s]("resource") : Y(b(br, [s])), a && (r.tr = !0, r.res = [], o(a, function (t) { function e(e) { var n = t[e]; return n > 0 ? n : 0 } var n = t.initiatorType, i = t.name, a = { o: e("startTime"), rt: n, n: i, f: e(Jr), ds: e(Jr), de: e($r), cs: e(Qr), ce: e(Zr), sl: e(ti), qs: e(Dr), rs: e(Lr), re: e(Br), ts: t.transferSize || 0, es: t.encodedBodySize || 0 }; if ("xmlhttprequest" === n) { var o = bt(i); o && (a.aid = o.s_id, a.atd = o.t_id, a.an = o.s_name, a.aq = o.s_qu, a.as = o.s_du) } r.res.push(a) })), r } function bt(t) { var e; return o(oi.xhrs, function (n, r) { if (r && t.indexOf(r) > -1) return e = n, !1 }), e } function St(t) { var e = {}; return t && (e.id = t.id, e.a = t.a, e.q = t.q, e.tid = t.tid, e.n = t.n), e } function Et(t) { if (!t.agent) { var n = e._ty_rum; if (n && n.agent) t.agent = n.agent; else { var r = "TINGYUN_DATA", i = N(r); if (i) { try { t.agent = J(decodeURIComponent(i)) } catch (a) { G(a && a.message) } A(r, "", -1e3) } } } return t.agent } function wt(t, e) { var n = 0, r = t.timing; return r ? fr[Hn] && fr[Hn] > 0 ? (n = fr[Hn], e.__fp = 2) : t.getEntriesByName && (n = r.domLoading, o(fr.resources, function (e) { var i = t.getEntriesByName(e); if (1 == i.length) { var a = i[0].responseEnd + r.navigationStart; a > n && (n = a) } }), n -= r.navigationStart, e.__fp = 1) : Y("fp=0"), P(function () { ur._fp = n }), Math.round(n) } function Tt(t, n, r, i) { var a = r || 0; if (Xn.lcp_switch && fr[Dn] && fr[Dn] > 0) return a = fr[Dn], i.__fs = 2, Math.round(a); var s = cr.firstScreenResources; if (s && s.length && t.getEntriesByName) return o(s, function (e) { var n = t.getEntriesByName(e); if (n.length) { var r = n[0], i = r.responseEnd; i > a && (a = i) } }), i.fs_s = 1, Math.round(a); var u = Pn.createElement("img"); if (!u.getBoundingClientRect) return P(function () { ur.fs = a }), a; if (t.getEntriesByName) { var c = e.innerHeight, f = e.innerWidth, l = []; o(Pn.querySelectorAll("img"), function (t) { t.src && qt(t.src) && kt(Ct(t), c, f) && !Ot(t) && l.push(t.src) }); var d = (n.loadEventEnd || oi.loadEventEnd) - n.navigationStart; o(l, function (e) { var n = t.getEntriesByName(e); if (n.length) { var r = n[0], i = r.responseEnd; r.fetchStart <= d && i > a && (a = i) } }) } return i.__fs = 1, Math.round(a) } function kt(t, n, r) { if (t) { var i = e.pageYOffset, a = t.top + (0 === i ? 0 : i || Pn.scrollTop || 0) - (Pn.clientTop || 0); if (a >= n) return !1; var o = t.left; return o >= 0 && o < r } return !1 } function Ct(t) { return He(t.getBoundingClientRect) ? t.getBoundingClientRect() : void 0 } function Ot(t) { return Qn.reliableHiddenOffsets() ? t.offsetWidth <= 0 && t.offsetHeight <= 0 && !t.getClientRects().length : It(t) } function It(t) { for (; t && 1 === t.nodeType;) { if ("none" === Rt(t) || "hidden" === t.type) return !0; t = t.parentNode } return !1 } function Rt(t) { return t.style && t.style.display } function qt(t) { if (!Xn.fs_resources || 0 === Xn.fs_resources.length) return !0; var e = !1; return o(Xn.fs_resources, function (n) { if (t.indexOf(n) > -1) return e = !0, !1 }), e } function Mt(t) { var e = n, r = 0; return t && (e = t.navigationStart || e, r = t[zr] || t.domInteractive || t.domLoading || r), r = r || oi._end, r - e } function Nt(t) { if (t) { var e = t.fetchStart; if (e) return e - t.navigationStart } } function At() { var t = {}, n = 0, r = e.performance; r && r.getEntriesByType && o(r.getEntriesByType("mark") || [], function (e) { if (e && e.name && e.startTime && 0 === e.name.indexOf(gn)) { var r = e.name.substring(gn.length); r && (t[r] = Math.round(e.startTime), n += 1) } }); var i = e[En] && e[En].data, a = _({}, i || {}, pr || {}); return a && r && r.timing && o(a, function (e, i) { je(e) && e.timestamp && (t[i] = e.timestamp - r.timing.navigationStart, n += 1) }), n > 0 ? t : null } function Ht(t, e) { var n = Me(t), r = n ? n.length : 0; if (r > wn && t.res && t.res.length > 0) { t.res = t.res.slice(0, e); var i = Me(t), a = i ? i.length : 0; return a > wn ? Ht(t, e - 10 > 0 ? e - 10 : 0) : t } return t } function jt() { lr.poMetricCollected ? ni() : (lr.pfWaitingPoMetric = !0, setTimeout(ni, Xn.max_metric_wait || Ln)) } function Dt() { function t(t) { try { var e = t.getEntries(); e && o(e, function (t) { t.entryType === Dn ? fr[Dn] = t.renderTime || t.loadTime : t.entryType === Hn && t.name === jn && (fr[Hn] = t.startTime), Lt(r) }) } catch (n) { } } if (!e.PerformanceObserver) return void (lr.poMetricCollected = !0); var n = [Hn]; Xn.lcp_switch && n.push(Dn); var r = [], i = e.PerformanceObserver.supportedEntryTypes || []; if (o(n, function (t) { i.indexOf(t) > -1 && r.push(t) }), P(function () { ur.et = r }), 0 == r.length) return void (lr.poMetricCollected = !0); try { o(r, function (n) { gr[n] = new e.PerformanceObserver(t), gr[n].observe({ type: n, buffered: !0 }) }) } catch (a) { } } function Lt(t) { var e = !0; o(t, function (t) { if (!fr[t]) return e = !1, !1 }), lr.poMetricCollected = e, lr.poMetricCollected && lr.pfWaitingPoMetric && jt() } function Bt() { Dt(), ii.on(tn, C(function () { t(); var e = k(); P(function () { ur.load = e }), oi.loadEventEnd = e })), o([tn, en, nn, rn], function (t) { Ye(e, t, function (e) { P(function () { (ur.e[t] || (ur.e[t] = [])).push(k()) }), ii.emit(t, e) }) }); var t = C(function () { var t = k(); P(function () { ur.end = t }), oi.domContentLoadedEventStart = t, Pn.querySelectorAll && (fr.resources = fr.resources || [], o(Pn.querySelectorAll("head>link,head>script"), function (t) { var e; "LINK" == t.tagName ? e = t.href : "SCRIPT" != t.tagName || t.defer || t.async || (e = t.src), e && fr.resources.push(e) })) }); Ye(Pn, "DOMContentLoaded", t), Ye(Pn, an, function (e) { Pn.readyState === on && t() }); var n = C(function () { oi.touch = k() }); o(["scroll", "click", "keypress"], function (t) { p(Pn, t, n) }) } function zt() { var t = this; t.xhrs = {}, t.errs = [], q.call(t) } function Pt() { if (Xn && Xn.did_cookie) { var t = N(Xn.did_cookie); if (null != t) return t } var e = Zn(un); return e ? e : tr(un, Qe(), fn) } function Ut() { var t = e.localStorage.getItem(cn); return t ? t.split(Cn) : null } function Ft(t) { t && 3 === t.length && e.localStorage.setItem(cn, t.join(Cn)) } function Xt() { var t = Ut(); return Wt(t) && (t = Gt()), t ? t[0] : "" } function Gt() { var t = k(), e = [Qe(), t, t]; return Ft(e), e } function Yt() { var t = k(), e = Ut(); Wt(e) ? (e = Gt(), si.sid = e[0]) : (e[2] = t, Ft(e)) } function Wt(t) { return !t || 3 !== t.length || k() - +t[2] > kn } function Jt(t) { function e(t, e, r) { var i = r || "log", a = n[t] || (n[t] = {}); a[i] = a[i] || "", a[i] += e } var n = {}, r = G(); if (e("Status", r, "ok" !== r), e("Debug", Y()), o(ci, function (t, n) { e("Timeline", n + ": " + t.toString()) }), !t && Nr) console.log("[TingYun Agent Diagnosis]\n"), o(n, function (t, e) { var n = console[e]; o(n, function (t, e) { console[e](t) }) }); else { if (t !== hn) return Me(n); Jn.href = Jn.href + "#" + Me(n) } } function $t(t) { this.limit = t, this.reset() } function Kt(t, e, n, r) { return String(t) + String(e) + String(n) + String(r) } function Vt(t, e, n, r, i, a, o, s, u) { var c = this; c.id = t, c.time = k(), c.msg = e, c.lineno = r, c.colno = i, c.filename = n, c.count = 1, c.stack = a && a.stack || "", c.module = o, c.trigger = s, c.customObj = u, c.fix(); var f = pi[t]; c.ep = f ? 0 : 1, pi[t] = !0 } function Qt(t) { if (lr.pf) { var e = function (t) { var e = []; return o(t, function (t) { e.push(t.toObject()) }), e }(vi.c); if (!e || !e.length) return null; var r = { fu: hi ? hi : hi++, os: parseInt((k() - (fr.pfStart || n)) / 1e3) }; cr.ulabel && (r.ulabel = cr.ulabel), oi.emit("send", "/err1", r, { datas: e }, m(vi.reset, vi)) } } function Zt(t, e, n, r, i, a, s) { if (e || !Yn) { var u = !1; if (o(Fn.domains, function (t) { if (u = t.test(e)) return !1 }), !u) { var c = i && i.moduleId, f = Kt(t, n, r, c), l = vi.get(f); l ? l.increase() : (l = new Vt(f, t, e, n, r, i, c, a, s), vi.add(f, l), oi.errs && oi.errs.push(l)) } } } function te() { var t = e.onerror; e.onerror = function (e, n, r, i, a) { if (Zt(e, n, r, i, a, li), He(t)) return t.apply(this, arguments) }, e.onerror._ty = !0 } function ee() { var t = e.onerror; t && t._ty || te() } function ne(t, e) { if (t) { var n = t.message || "", r = t.stack, i = "", a = 0, s = 0; if (r) { var u = r.split(/\n/); o(u, function (t, e) { if (t && (t = t.trim()), t && 0 === t.indexOf("at ")) { var n = t.indexOf("("), r = t.indexOf(")"); if (n && r) { var o = n + 1; o > r && (o = r); var u = t.substring(o, r); if (u) { var c = u.split(":"); c && c.length > 2 && (i = (c.slice(0, c.length - 2) || []).join(":"), a = +c[c.length - 2], s = +c[c.length - 1]) } } } if (i && De(a) && a > 0 && De(s) && s > 0) return !1 }) } Zt(n, i, a, s, { stack: r }, fi, e) } } function re() { var t = $e(); return t ? te() : Ye(e, Ze, function (t) { var n, r, i, a, o; (t instanceof e.Event || e.ErrorEvent && t instanceof e.ErrorEvent) && (n = t.message || t.error && (t.error.message || t.error.constructor.name) || "", r = t.lineno || 0, i = t.colno || 0, a = t.filename || t.error && t.error.filename || t.target && t.target.baseURI || "", a == Pn.URL && (a = "#"), o = t.error), Zt(n, a, r, i, o, li) }), ii.on([tn, en, nn, rn], function (t) { Qt() }).on(tn, function () { t && w(ee) }), setInterval(Qt, di) } function ie(t) { return function e(n, r) { var i = this, a = e; if (a._ && (a._ = 1), !i[vn]) { var o = i[ln] = {}; o.method = n, o.url = r, o.id = dr.uniqueId++; var s = qr.get("event"); s && (o.key = s.key, s.remain++) } try { return t.apply(i, arguments) } catch (u) { } } } function ae(t) { return function e(n, r) { var i = this, a = e; if (a._ && (a._ = 1), !i[vn]) { var o = i[ln]; o && n && "ty_rum_path" === n && (o.ty_rum_path = r) } try { return t.apply(i, arguments) } catch (s) { } } } function oe(t) { return function e(n) { var r = this, i = e; if (i._ && (i._ = 1), !r[vn]) { var a = r[ln]; a && (a.start = k(), a.reqSize = O(n)), fe(r), r.setRequestHeader && Xn.id && a && gi(a.url) && (a.r = k() % 1e9, r.setRequestHeader("X-Tingyun-Id", Xn.id + ";r=" + a.r)) } try { return t.apply(r, arguments) } catch (o) { } } } function se(t) { o(mi, function (e, n) { var r = "on" + n; t[r] ? z(t, r, function (n) { if (ce(t, e), He(n)) return n.apply(this, arguments) }) : t[r] = function () { ce(t, e) } }) } function ue(t) { o(mi, function (e, n) { Ye(t, n, function () { ce(t, e) }) }) } function ce(t, e) { t && t[ln] && (t[ln].errorCode = e) } function fe(t) { function e(e) { return rt(function n() { var r = n; r._ && (r._ = 1), le(t); var i; if (He(e)) { var a = t[ln]; if (a && 4 == t.readyState) var o = k(); i = e.apply(this, arguments), a && 4 == t.readyState && (a.cbTime = k() - o) } return i }) } var n = t[yi]; if (n) { z(t, yi, e); try { ue(t) } catch (r) { } } else try { Ye(t, an, rt(function i() { var e = i; e._ && (e._ = 1), le(t) })), ue(t) } catch (r) { return void w(function () { se(t), z(t, yi, e) }) } w(function () { z(t, yi, e) }) } function le(t) { var e = t[ln]; if (e && (e.end = k(), e.readyState = t.readyState, 4 == t.readyState)) { e.status = t.status, e.resSize = de(t); var n = qr.get("event"); w(function () { if (!Q(e)) { var r = he(e, t); n && n.key == e.key && (n.xhrs.push(r), 0 === --n.remain && n._end()), oi.xhrs && (wr(e), oi.xhrs[e.url] = r), dr.xhrs.push(r), hr.recording && hr.xhrs.push(r) } }) } } function de(t) { var e = 0; if ("" == t.responseType || "text" == t.responseType) e = O(t.responseText); else if (t.response) e = O(t.response); else try { e = O(t.responseText) } catch (n) { } return e } function he(t, e) { if (t) { var n = t.status, r = { id: t.id, req: t.method + " " + t.url, start: t.start, du: n > 0 ? t.end - t.start : 0, cb: t.cbTime || 0, status: n, err: t.errorCode ? t.errorCode : 0, rec: t.resSize, send: t.reqSize, type: _n }; if (t.ty_rum_path && (r.csheader = t.ty_rum_path), t.r) { var i = K(e, t); i && V(r, i) } return r } } function ve() { var t = Un && Un.prototype; t ? (z(t, "open", ie), z(t, "setRequestHeader", ae), z(t, "send", oe)) : Un && (e.XMLHttpRequest = function () { var t = new Un; return z(t, "open", ie), z(t, "send", oe), z(t, "setRequestHeader", ae), t }) } function pe(t, e) { if (Xn.id && t && gi(t.url)) { t.r = k() % 1e9; var n = Xn.id + ";r=" + t.r; if (e) { var r = e.headers; Be(r) ? (e.headers || (e.headers = new Headers), e.headers.append(mn, n)) : je(r) ? e.headers[mn] = n : r || (e.headers = {}, e.headers[mn] = n) } else e = { headers: {} }, e.headers[mn] = n } return e } function ge(t, e) { if (t) { var n = { id: t.id, req: (t.method || "GET") + " " + t.url, start: t.start, du: t.status > 0 ? t.end - t.start : 0, cb: 0, status: t.status, err: 0, rec: 0, send: 0, type: xn }; if (t.ty_rum_path && (n.csheader = t.ty_rum_path), t.r) { var r = K(e, t, xn); r && V(n, r) } return n } } function me(t) { return function e() { var n = e; n._ && (n._ = 1); var r = this, i = Pe.call(arguments, 0); return new Promise(function (e, n) { var a, o, s = "GET", u = 1; if (i) if (i.length > 1) a = i[0], o = i[1], u = 1, o && je(o) && (s = o.method); else if (1 === i.length) { var c = i[0]; Ne(c) ? a = c : c && (je(c) || ze(c)) && (o = c, u = 0, a = c.url, s = c.method) } var f = { id: dr.uniqueId++, method: s, url: a }, l = pe(f, o); if (l && (i[u] = l, l.headers)) { var d; Be(l.headers) ? d = l.headers.get(Sn) : je(l.headers) && (d = l.headers[Sn]), d && (f[Sn] = d) } var h = qr.get("event"); h && (f.key = h.key, h.remain++), f.start = k(); var v; try { v = t.apply(r, i) } catch (p) { return void n(p) } v.then(rt(function g(t) { var n = g; if (n._ && (n._ = 1), f.end = k(), t) { f.status = t.status; var r = qr.get("event"); w(function () { if (!Q(f)) { var e = ge(f, t); r && r.key == f.key && (r.xhrs.push(e), 0 === --r.remain && r._end()), oi.xhrs && (wr(f), oi.xhrs[f.url] = e), dr.xhrs.push(e), hr.recording && hr.xhrs.push(e) } }) } e(t) }), function (t) { n(t) }) }) } } function ye() { e.fetch && z(e, "fetch", me) } function _e() { return setInterval(function () { if (lr.pf && dr.xhrs && dr.xhrs.length) { var t = []; if (o(dr.xhrs, function (e) { t.push(e) }), t = x(t, function (t) { return (xi.indexOf ? xi.indexOf(t) : S(xi, t)) < 0 }), t && t.length) { xi = t; var e = null; cr.ulabel && (e = { ulabel: cr.ulabel }), oi.emit("send", "/xhr1", e, { xhr: t }, function () { dr.xhrs = x(dr.xhrs, function (e) { return (t.indexOf ? t.indexOf(e) : S(t, e)) < 0 }) }), $e() && !window.XDomainRequest && (dr.xhrs = []) } } }, _i) } function xe(t) { if (t && je(t)) { var e = t.du; e || (e = t.status > 0 && t.end && t.start ? t.end - t.start : 0); var n = { req: t.method + " " + t.url, start: t.start, du: e, cb: t.cb || 0, status: t.status || 0, err: t.err || 0, rec: t.rec || 0, send: t.send || 0, type: bn }; dr.xhrs || (dr.xhrs = []), dr.xhrs.push(n) } } function be() { return Xn.disable_ajax || (ve(), ye()), _e() } function Se() { return Si || {} } function Ee(t, e) { je(e) || (e = {}), t && t.beforeEach && t.afterEach && (t.beforeEach(function (t, e, n) { var r = t.path; Ei[r] && !Ei[r].e || (Ei[r] = gt({ key: r })), n() }), t.afterEach(function (t, n) { var r = t.path; setTimeout(function () { var t = Ei[r]; !t || t.called || t.e || (e && e.status === An ? t.fail() : t.end()) }, e.endDelay || Mn) })) } function we(t, e) { var n; if (je(t)) n = t; else { if (!Ne(t) || void 0 === e) throw new zn(Sr); n = {}, n[t] = e } return o(n, function (t, e) { e in wi ? cr[wi[e]] = t : cr[e] = t }), this } function Te(t) { if (t) { var e = cr.firstScreenResources = cr.firstScreenResources || []; Ae(t) || (t = [t]), o(t, function (t) { if (Ne(t)) e.push(t); else if (ui(t)) { var n = t.src || t.href; n && e.push(n) } }) } } function ke(t) { Ae(t) || (t = [t]), o(t, function (t) { if (t) { if (!(t instanceof RegExp)) throw new zn("parameter's type requires RegExp"); (Fn.domains || (Fn.domains = [])).push(t) } }) } function Ce(t) { vr && (vr.did = t) } function Oe(t, e) { if (t) { var n = t.split("_"), r = n[0], i = n[1]; "ty" === r && i && X(i, { timestamp: k(), data: e }) } } function Ie() { if (Object.defineProperty) { var t = e[ln]; Object.defineProperty(e, ln, { get: function () { return Ci++ > 0 && e.console && console.warn("window.%s is deprecated, use window.%s instead.", ln, dn), t } }) } } function Re() { return oi.start() && (ri(), be(), re()), oi._end = k(), P(function () { ur._end = oi._end }), Ie(), Ti } var qe, Me, Ne = s("String"), Ae = s("Array"), He = s("Function"), je = s("Object"), De = s("Number"), Le = s("Undefined"), Be = s("Headers"), ze = s("Request"), Pe = [].slice, Ue = '"', Fe = /([\"\\])/g, Xe = /\n/g, Ge = e.JSON; Ge && Ge.parse && Ge.stringify ? (qe = r, Me = i) : (qe = u, Me = c); var Ye, We; e.addEventListener ? (Ye = l, We = d) : (Ye = h, We = v); var Je = e.encodeURIComponent, $e = function () { return !document.addEventListener }, Ke = e.location.protocol, Ve = "http:", Qe = function () { function t(t) { return t < 0 ? NaN : t <= 30 ? 0 | Math.random() * (1 << t) : t <= 53 ? (0 | Math.random() * (1 << 30)) + (0 | Math.random() * (1 << t - 30)) * (1 << 30) : NaN } function e(t, e) { for (var n = t.toString(16), r = e - n.length, i = "0"; r > 0; r >>>= 1, i += i)1 & r && (n = i + n); return n } return function () { return e(t(32), 8) + "-" + e(t(16), 4) + "-" + e(16384 | t(12), 4) + "-" + e(32768 | t(14), 4) + "-" + e(t(48), 12) } }(); q.prototype = { on: function (t, e) { var n = this; return Ne(t) ? (n.events[t] || (n.events[t] = [])).push(e) : Ae(t) && o(t, function (t) { n.on(t, e) }), n }, off: function (t, e) { var n = arguments.length, r = this; if (0 === n) return r.events = {}, r; var i = r.events[t]; if (!i) return r; if (1 === n) return r.events[t] = null, r; for (var a, o = i.length; o--;)if (a = i[o], a === e) { i.splice(o, 1); break } return r }, emit: function (t) { var e = [].slice.call(arguments, 1), n = this.events[t]; return n && o(n, function (t) { return t.apply(this, e) }), this }, unshift: function (t, e) { var n = this; return (n.events[t] || (n.events[t] = [])).unshift(e), n } }; var Ze = "error", tn = "load", en = "unload", nn = "beforeunload", rn = "pagehide", an = "readystatechange", on = "complete", sn = "on", un = "TY_DISTINCT_ID", cn = "TY_SESSION_ID", fn = 86400, ln = "_ty_rum", dn = "TINGYUN", hn = 2, vn = "__ign", pn = "__ty_aysncWrap__", gn = "ty_", mn = "X-Tingyun-Id", yn = "X-Tingyun-Tx-Data", _n = "XHR", xn = "FETCH", bn = "CUSTOM_AJAX", Sn = "ty_rum_path", En = "__TINGYUN", wn = 64512, Tn = ["trace", "debug", "info", "warn", "error"], kn = 18e5, Cn = "|", On = "__TY_SPE_STORE", In = 6e4, Rn = "auto", qn = "defined", Mn = 200, Nn = "success", An = "fail", Hn = "paint", jn = "first-paint", Dn = "largest-contentful-paint", Ln = 5e3, Bn = 1e4, zn = e.Error, Pn = e.document, Un = e.XMLHttpRequest, Fn = {}; t(Fn); var Xn = Fn.server || {}, Gn = { fp_threshold: 2e3, fs_threshold: 4e3, dr_threshold: 4e3 }; Xn = _(Gn, Xn, e[En] && e[En].config || {}); var Yn = M("ignore_err"), Wn = M("debug"), Jn = e.location, $n = e.navigator, Kn = e.HTMLElement, Vn = function () { try { var t = Qe(); return e.localStorage.setItem(t, t), e.localStorage.removeItem(t), !0 } catch (n) { return !1 } }(), Qn = {}; Qn.localStorage = Vn, function () { function t() { var t, f, l = Pn.documentElement; l.appendChild(u), c.style.cssText = "-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%", n = i = s = !1, r = o = !0, e.getComputedStyle && (f = e.getComputedStyle(c), n = "1%" !== (f || {}).top, s = "2px" === (f || {}).marginLeft, i = "4px" === (f || { width: "4px" }).width, c.style.marginRight = "50%", r = "4px" === (f || { marginRight: "4px" }).marginRight, t = c.appendChild(Pn.createElement("div")), t.style.cssText = c.style.cssText = "-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0", t.style.marginRight = t.style.width = "0", c.style.width = "1px", o = !parseFloat((e.getComputedStyle(t) || {}).marginRight), c.removeChild(t)), c.style.display = "none", a = 0 === c.getClientRects().length, a && (c.style.display = "", c.innerHTML = "<table><tr><td></td><td>t</td></tr></table>", t = c.getElementsByTagName("td"), t[0].style.cssText = "margin:0;border:0;padding:0;display:none", a = 0 === t[0].offsetHeight, a && (t[0].style.display = "", t[1].style.display = "none", a = 0 === t[0].offsetHeight)), l.removeChild(u) } var n, r, i, a, o, s, u = (Pn.documentElement, Pn.createElement("div")), c = Pn.createElement("div"); c.style && (c.style.cssText = "float:left;opacity:.5", Qn.opacity = "0.5" === c.style.opacity, Qn.cssFloat = !!c.style.cssFloat, c.style.backgroundClip = "content-box", c.cloneNode(!0).style.backgroundClip = "", Qn.clearCloneStyle = "content-box" === c.style.backgroundClip, u = Pn.createElement("div"), u.style.cssText = "border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute", c.innerHTML = "", u.appendChild(c), Qn.boxSizing = "" === c.style.boxSizing || "" === c.style.MozBoxSizing || "" === c.style.WebkitBoxSizing, Qn.reliableHiddenOffsets = function () { return null == n && t(), a }) }(); var Zn, tr; Qn.localStorage ? (Zn = function (t) { return e.localStorage.getItem(t) }, tr = function (t, n) { return e.localStorage.setItem(t, n), n }) : (Zn = N, tr = A); var er, nr = function () { var t = e.navigator.standalone, n = e.navigator.userAgent.toLowerCase(), r = /safari/.test(n), i = /iphone|ipod|ipad/.test(n); return i && !t && !r }, rr = "display:none", ir = "POST", ar = L; e.XDomainRequest ? er = H : $e() ? er = D : $n.sendBeacon ? ar = er = B : er = L; var or = nr(); or && (ar = er = L); var sr = Wn, ur = { start: n, e: {}, an: { count: 0 }, visible: [] }, cr = {}, fr = {}, lr = { pf: !1, poMetricCollected: !1, pfWaitingPoMetric: !1 }, dr = { uniqueId: 0, xhrs: [] }, hr = { recording: !1, xhrs: [] }, vr = {}, pr = {}, gr = {}, mr = {}, yr = e.screen; yr && (mr.sh = yr.height, mr.sw = yr.width); var _r = [], xr = [], br = "{0} not support", Sr = "illegal argument", Er = function (t) { var e = []; return o(t, function (t) { try { e.push(new RegExp(t)) } catch (n) { G(n && n.message) } }), e }(Xn.custom_urls), wr = Er.length ? function (t) { var e = t.url; !oi.ct && e && o(Er, function (n) { if (e.match(n)) return oi.ct = t.end, !1 }) } : T, Tr = 1, kr = 2, Cr = 4, Or = 8, Ir = tt.prototype; Ir.create = Ir.before = Ir.after = Ir.error = null; var Rr; ot.prototype = { createContext: function () { return Object.create ? Object.create(this.active) : at(this.active) }, get: function (t) { if (this.active) return this.active[t] }, set: function (t, e) { if (this.active) return this.active[t] = e }, enter: function (t) { if (!t) throw new zn("context required!"); this._set.push(this.active), this.active = t }, exit: function (t) { if (!t) throw new zn("context required!"); if (t === this.active) return void (this.active = this._set.pop()); var e = this._set.lastIndexOf ? this._set.lastIndexOf(t) : E(this._set, t); if (e < 0) throw new zn("context not currently entered!"); this._set.splice(e, 1) }, bind: function (t, e) { e || (e = this.active ? this.active : this.createContext()); var n = this; return function () { n.enter(e); try { return t.apply(this, arguments) } catch (r) { try { var i = "moduleId"; r[i] = e[i] } catch (a) { } throw r } finally { n.exit(e) } } } }; var qr, Mr = !1, qr = ut(), Nr = "undefined" != typeof e.console, Ar = ct.prototype; Ar.fail = Ar.end = T; var Hr = ft.prototype; Hr.end = Hr.finish = Hr.fail = null, Hr.send = function (t) { this.sent = !0; var e = this.getEventData(t); oi.emit("send", "/spe", null, e, T) }, Hr.getEventData = function (t) { var e = this, n = t.event && t.event.xhrs || []; return o(n, function (t) { t.start = t.start - e.s }), { key: e.key, start: e.s, duration: e.e - e.s, status: e.status, type: e.type, xhrs: n } }, Hr.refreshEventAndStore = function (t) { this.finish(); var n = this.getEventData(t); e.localStorage.setItem(On, Me(n)) }; var jr = {}, Dr = "requestStart", Lr = "responseStart", Br = "responseEnd", zr = "domContentLoadedEventStart", Pr = "domContentLoadedEventEnd", Ur = "domInteractive", Fr = "domComplete", Xr = "loadEventStart", Gr = "loadEventEnd", Yr = "unloadEventStart", Wr = "unloadEventEnd", Jr = "domainLookupStart", $r = "domainLookupEnd", Kr = "redirectStart", Vr = "redirectEnd", Qr = "connectStart", Zr = "connectEnd", ti = "secureConnectionStart", ei = Et(Fn); ei && ei.ulabel && (cr.ulabel = ei.ulabel); var ni = C(function () { function t(t) { return t ? "1" : "0" } var r = e.performance, i = !!r; i || Y(b(br, ["pf"])); var a = St(ei), s = r && r.timing, u = _(_t(s), a, cr), c = _({}, mr); c.ressize = !!s, oi.fp ? (c.fp = oi.fp, i && oi.fp > oi._le && (Y("fp>le"), c.fp = wt(r, c))) : i ? c.fp = wt(r, c) : c.fp = c.__fp = 0, c.dr = Mt(s), i ? c.fs = Tt(r, s, c.fp, c) : c.__fs = 0; var f = "", l = At(), d = _(u, c) || {}; l && o(l, function (t, e) { De(t) && t >= 0 && (d[e] = t) }); var h; if (i) { var v = "trace", p = Math.max(d.ls, 0); p || (p = yt() - s.navigationStart || n), d[v] = p; var g = Nt(s); o(["fp", "fs", "dr", v], function (e) { f += t((g ? d[e] - g : d[e]) >= Xn[e + "_threshold"]) }), delete d[v], f.indexOf("1") > -1 && (h = xt(r, s)), l && (h || (h = {}), h.mark = l) } d.trflag = f || "0000", fr.pfStart = k(), delete d.firstScreenResources, delete d.resources, h && (h = Ht(h, 150)), oi.emit("send", "/pf", d, h, function () { Y("pf sent!"), oi.xhrs = oi.errs = null, lr.pf = !0, Z(), setTimeout(pt, Xn.crosspage_ajax_store_time || Bn) }) }), ri = function () { return ii.on(tn, function () { var t = 0; if (Xn.pfDelay && je(Xn.pfDelay)) { var e = At(); o(Xn.pfDelay, function (n, r) { (!e || null == e[r]) && De(n) && n > t && (t = n) }) } setTimeout(jt, t) }).on([en, nn, rn], jt) }; !function () { if (Wn) { var t, e, n = "visibilitychange"; Le(Pn.hidden) ? Le(Pn.msHidden) ? Le(Pn.webkitHidden) || (t = "webkitHidden", e = "webkit" + n) : (t = "msHidden", e = "ms" + n) : (t = "hidden", e = n), Le(Pn.addEventListener) || Le(Pn[t]) || Ye(Pn, e, U(function () { ur.visible.push([Pn[t], k()]) })) } }(); var ii = new q, ai = zt.prototype; ai.start = function () { if (!Xn.key) return G("missing config, agent disabled!"), !1; var t = e[ln] || e[dn]; return t && t.server ? (G("already loaded!"), !1) : (Bt(), vt(), this) }, _(ai, q.prototype); var oi = new zt; oi.on("send", function (t, e, n, r) { Yt(); var i = R(Xn.beacon, t, _({}, si, e || {}, vr || {})); switch (r = r || T, t) { case "/pf": n ? er(i, n, function () { oi.xhrs = oi.errs = null, r() }) : ar(i, void 0, r); break; default: er(i, n, r) } }); var si = {
          pvid: Qe(), ref: Pn.URL, referrer: Pn.referrer, key: Xn.key, v: "1.8.5", av: "1.8.5", did: Pt(), sid: Xt()
        }, ui = Kn ? function (t) { return t instanceof Kn } : function (t) { t && "object" == typeof t && 1 === t.nodeType && Ne(t.nodeName) }, ci = {}, fi = "api", li = "onerror", di = 1e4, hi = 0; $t.prototype = { add: function (t, e) { this.len > this.limit || this.get(t) || (this.c[t] = e, this.len++) }, get: function (t) { return this.c[t] }, reset: function () { this.c = {}, this.len = 0 } }; var vi = new $t(100), pi = {}; Vt.prototype = { increase: function () { this.count++ }, fix: function () { var t = this, e = t.stack; if (e && Ne(e)) { e = e.split(/\n/); var n = []; o(e, function (t, e) { t.indexOf(pn) == -1 && n.push(t) }), t.stack = n.join("\n") } }, toObject: function () { var t = this; return { o: t.time, e: t.msg, l: t.lineno, c: t.colno, r: t.filename, ec: t.count, s: t.stack, m: t.module, ep: t.ep, tr: t.trigger, co: t.customObj } } }; var gi = function () { function t(t) { var e = t; return n && (r.setAttribute("href", e), e = r.href), r.setAttribute("href", e), { href: r.href, protocol: r.protocol ? r.protocol.replace(/:$/, "") : "", host: r.host, search: r.search ? r.search.replace(/^\?/, "") : "", hash: r.hash ? r.hash.replace(/^#/, "") : "", hostname: r.hostname, port: r.port, pathname: "/" === r.pathname.charAt(0) ? r.pathname : "/" + r.pathname } } function e(t) { var e = !1; return Xn.cors_domains && o(Xn.cors_domains, function (n) { if (t.indexOf(n) > -1) return e = !0, !1 }), e } var n = /(msie|trident)/i.test($n.userAgent), r = Pn.createElement("a"), i = t(Jn.href); return function (n) { var r = t(n); return r.protocol === i.protocol && r.host === i.host || e(r.host) } }(), mi = { error: 990, abort: 905, timeout: 903 }, yi = sn + an, _i = 2e3, xi = [], bi = [], Si = {}; Tn && Tn.length > 0 && (o(Tn, function (t) { Si[t] = function (e, n) { var r = { msg: e || "", time: n && n._time || k(), level: t }; n && (r.options = n), bi.push(r) } }), Si.info && (Si.log = Si.info)); var Ei = {}, wi = { host: "cshst", url: "csurl" }, Ti = { version: "1.8.5", config: we, DIAGNOSE_HREF: hn, diagnose: Jt, createEvent: lt, logFirstScreen: Te, addExcludedDomain: ke, setError: ne, addAjax: xe, setDid: Ce, mark: Oe, endStoreEvent: ht, wrapVueRouter: Ee, packageTime: "20200724", createAutoEvent: gt }, ki = Se(); ki && o(ki, function (t, e) { Ti[e] = t }), e[ln] = e[dn] = Ti; var Ci = 0, Oi = Re(); return Oi
      }(function (ty_rum) { ty_rum.server = { id: 'P6MDM2s9q8o', ignore_err: true, beacon: 'beacon.tingyun.com', beacon_err: 'beacon-err.tingyun.com', key: 'lhSOLV_VovU', trace_threshold: 7000, fp_threshold: 2000, fs_threshold: 4000, dr_threshold: 4000, custom_urls: [], sr: 1.0 }; }, window, +new Date);</script>
  <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>

  
  <link rel="stylesheet" href="https://unpkg.com/octomments/build/ocs-ui.min.css" />
  <meta name="keywords" content="Canvas," />
  

  
  <meta name="description" content="源自于节日活动的一个地图点亮需求, 需要根据用户的所在的省份，依次点亮被用户所在的省份。里面涉及到计算用户的位置，移动目标的位置，以及移动轨迹。省份点亮等。由于页面采用大量的动画进行交互，所以第一步主要考虑如何选择合适的动画实现方案。这个需求要同时满足性能和业务的要求，面临不少的挑战：图片多：100多张图片" />
  

  
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.0.1" />
  
  <title>不会写动画的前端不是好前端 [ 果糖酱的博客 ]</title>
  
  <!-- stylesheets list from config.yml -->
  
  <link rel="stylesheet" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css">
  
  <link rel="stylesheet" href="/css/xoxo.css">
  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div class="nav-container">
    <nav class="home-menu pure-menu pure-menu-horizontal">
  <a class="pure-menu-heading" href="/">
    <img class="avatar" src="/assets/images/logo.png">
    <span class="title">果糖酱的博客</span>
  </a>

  <ul class="pure-menu-list clearfix">
      
          
            <li class="pure-menu-item"><a href="/" class="pure-menu-link">首页</a></li>
          
      
          
            <li class="pure-menu-item"><a href="/archives" class="pure-menu-link">归档</a></li>
          
      
          
            <li class="pure-menu-item"><a href="/tags" class="pure-menu-link">标签</a></li>
          
      
          
            <li class="pure-menu-item"><a href="/about" class="pure-menu-link">关于</a></li>
          
      
  </ul>
   
</nav>
  </div>

  <div class="container" id="content-outer">
    <div class="inner" id="content-inner">
      <div class="post-container">
  <article class="post" id="post">
    <header class="post-header text-center">
      <h1 class="title">
        不会写动画的前端不是好前端
      </h1>
      <span>
        
        <time class="time" datetime="2019-11-03T02:47:36.000Z">
        2019-11-03
      </time>
        
      </span>
      <span class="slash">/</span>
      <span class="post-meta">
      <span class="post-tags">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Canvas/" rel="tag">Canvas</a></li></ul>
      </span>
    </span>
      <span class="slash">/</span>
      <span class="read">
      <span id="busuanzi_value_page_pv"></span> 点击
    </span>
      <span class="slash">/</span>
      <span class="read">阅读耗时 14 分钟</span>
    </header>

    <div class="post-content">
      <h1 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a>一、背景</h1><p>2019年底公司计划推出一个地图需求，整个需求大致分为三幕动画：</p>
<p>1、第一幕<br>根据用户所在省份，画出用户的头像，然后画出一条贝塞尔曲线，箭头最终指向用户第一个受助人所在的省份。</p>
<p>2、第二幕<br>受助人头像开始下落变成红点，同时放大所在区域，到指定比例。 此时出现录音弹框，开始自动播放受助人录音。录音播放完毕后，背景地图恢复原始尺寸。</p>
<p>3、第三幕</p>
<p>其他受助人头像开始一个个出现的同时，并且下落到地图上，逐渐变小成为地图上的一个点，这个过程重复出现，速度越来越快，最终形成一个红点闪闪的地图。</p>
<p>由于页面采用大量的动画进行交互，所以第一步主要考虑如何选择合适的动画实现方案。</p>
<h1 id="二、技术选型"><a href="#二、技术选型" class="headerlink" title="二、技术选型"></a>二、技术选型</h1><h2 id="1、实现动画的方法"><a href="#1、实现动画的方法" class="headerlink" title="1、实现动画的方法"></a>1、实现动画的方法</h2><p>前端可以使用哪些方式实现动画呢？</p>
<p>1、最省事的办法就是vedio或gif图片了，优点是，沟通成本低；缺点就是在色彩，透明度表现力不如png, 且交互性差。<br>2、Flash，手机端就别考虑了。不久的未来，也会被淘汰。<br>3、js + CSS3 animation, 应该是目前前端广泛使用的方式了。具有开发成本低、兼容性好、具备互动性，加上 PNG 图片很好的色彩与透明度的表现力基本能满足很多动画需求<br>4、Canvas, 无须插件，浏览器支持良好，可以绘制各种图形以及具备高性能图片渲染能力，缺点是，纯手工编写canvas成本较高，动画实现较为繁琐。<br>5、WebGL 在Canvas的基础上，增加了 OpenGL ES 的 3D 绘制能力，并且能开启硬件 3D 加速渲染，让前端动画的世界充满了更多想象的空间。</p>
<h2 id="2、为什么选择Canvas"><a href="#2、为什么选择Canvas" class="headerlink" title="2、为什么选择Canvas"></a>2、为什么选择Canvas</h2><p>vedio或gif的适合与用户数据无关的交互。</p>
<p>通过JS改变Dom节点的css属性虽然具有开发成本低、兼容性好、具备互动性等优点，但是在复杂场景下，性能会是问题，不是特别流畅。</p>
<p>Canvas, 无须插件，浏览器支持良好，可以绘制各种图形以及具备高性能图片渲染能力，缺点是，纯手工编写canvas成本较高，动画实现较为繁琐，</p>
<p>不过可以通过一定的方法封装解决。</p>
<h2 id="3、面临的挑战"><a href="#3、面临的挑战" class="headerlink" title="3、面临的挑战"></a>3、面临的挑战</h2><p>这个需求要同时满足性能和业务的要求，面临不少的挑战：</p>
<p>场景多：每个用户看到的动画都是不一样的，还要考虑受助人与用户头像省份重叠的问题，箭头的指向角度问题等等。</p>
<p>动画多：很多的精灵动画，包括头像的出现，贝塞尔曲线，头像的下落，地图局部放大缩小等。</p>
<p>图片多：设计提供100多张图片。前端要想办法减少加载的图片的数量，为了保证动画的流畅，需要提前把第一幕图片提前加载好。</p>
<h1 id="三、实现方案"><a href="#三、实现方案" class="headerlink" title="三、实现方案"></a>三、实现方案</h1><h2 id="3-1-图片资源预加载"><a href="#3-1-图片资源预加载" class="headerlink" title="3.1 图片资源预加载"></a>3.1 图片资源预加载</h2><h3 id="预加载"><a href="#预加载" class="headerlink" title="预加载"></a>预加载</h3><p>1、为确保用户看到的动画是平滑流畅的，需要进行图片预加载，包括：用户头像（受助人20个头像），地图背景（含：大，小两套），头像外框角标等：</p>
<p>图片预加载函数通过Promise实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 预加载图片url</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">图片地址</span>&#125; <span class="variable">url</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loadImage</span> = (<span class="params">url</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> newImage = <span class="keyword">new</span> <span class="title class_">Image</span>()</span><br><span class="line">    newImage.<span class="property">loadTimes</span> = <span class="number">0</span></span><br><span class="line">    newImage.<span class="property">src</span> = url</span><br><span class="line">    newImage.<span class="property">crossOrigin</span> = <span class="string">&#x27;Anonymous&#x27;</span></span><br><span class="line">    newImage.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(newImage)</span><br><span class="line">    &#125;</span><br><span class="line">    newImage.<span class="property">onerror</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      newImage.<span class="property">loadTimes</span>++</span><br><span class="line">      <span class="keyword">if</span> (newImage.<span class="property">loadTimes</span> &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">        newImage.<span class="property">src</span> = defaultAvator</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        newImage.<span class="property">onerror</span> = <span class="literal">null</span></span><br><span class="line">        newImage.<span class="property">onload</span> = <span class="literal">null</span></span><br><span class="line">        newImage = <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>函数做了一个小优化，如果图片第一次由于流量大等原因没有加载成功，会进行二次加载，为避免循环加载，限制了每张图片最多加载的次数为3.</p>
</blockquote>
<p>利用 <code>Promise.all</code> 等待所有图片全部加载成功, 将所有图片对象全部返回：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">loadImages</span> = <span class="keyword">async</span> (<span class="params">avatorUrl ...</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> renderList = []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; aidedAvators.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    renderList.<span class="title function_">push</span>(<span class="keyword">await</span> <span class="title function_">loadImage</span>(aidedAvators[i]))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> myAvator = <span class="keyword">await</span> <span class="title function_">loadImage</span>(avatorUrl)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([myAvator ..., ...renderList]).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">myAvator</span>: myAvator,</span><br><span class="line">      ...</span><br><span class="line">      <span class="attr">avator20</span>: renderList</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="执行时机"><a href="#执行时机" class="headerlink" title="执行时机"></a>执行时机</h3><p>首次进入活动页面时会先进入 <code>loading</code> 页面，所以说 <code>loading</code> 页面是最好的执行资源预加载的时机：</p>
<p>这块的具体实现逻辑：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- loading组件 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;showLoading&quot;</span> <span class="attr">class</span>=<span class="string">&quot;process&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;process-number&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">countTo</span> <span class="attr">:startVal</span>=<span class="string">&quot;0&quot;</span> <span class="attr">:endVal</span>=<span class="string">&quot;99&quot;</span> <span class="attr">:duration</span>=<span class="string">&quot;3000&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;%&quot;</span> @<span class="attr">callback</span>=<span class="string">&quot;loadFinish&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">countTo</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;ani_dot&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>countTo组件定义了初始值0，最终值99，整个动画完成时间3s</p>
</blockquote>
<p><code>loadFinish()</code> 将在动画完成时调用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="title function_">loadFinish</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">loadFinished</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">showContent</span>()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">loadFinished</span> = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这里定义了一个 <code>this.loadFinished</code> 变量，初始值为 false。 这里为什么需要设计这个变量呢？</p>
<p>还记得我们之前定义的图片预加载函数吗，我们在页面是这样使用的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">    <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">loadImages</span>(...images).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">images</span> = &#123; ...res &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">beginning</span>.<span class="title function_">loadFinish</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在<code>loadImages()</code>的回调函数里面也调用了 <code>loadFinish()</code> 函数，<code>this.loadFinished</code> 变量在第一次进入时，走的else分支，为 <code>this.loadFinished</code> 赋值为 true, 下一次再次进入 <code>loadFinish()</code> 时，就满足了if 分支的条件，所以就会进入主页面。</p>
<h2 id="3-2-动画模块设计"><a href="#3-2-动画模块设计" class="headerlink" title="3.2 动画模块设计"></a>3.2 动画模块设计</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">activity   </span><br><span class="line">│</span><br><span class="line">└───annualHelpMap</span><br><span class="line">│   │</span><br><span class="line">│   └───engine</span><br><span class="line">│       │   Sprite.js                   -- 动画基类</span><br><span class="line">│       │   Avator.js                   -- 互助头像</span><br><span class="line">│       │   Connect.js                  -- 头像运动轨迹，贝塞尔曲线</span><br><span class="line">│       │   Landing.js                  -- 头像下落雨动画</span><br><span class="line">│       │   Map.js                      -- 背景地图动画</span><br><span class="line">│   config.js                           -- 工具类方法，图片预加载</span><br><span class="line">│   const.js                            -- 存放头像尺寸、坐标等信息</span><br></pre></td></tr></table></figure>

<p>Sprite.js 提供了动画类基础的方法：</p>
<p><img src="/assets/images/2020-02/Sprite.png" alt="Sprite"></p>
<p>Avator，Connect，Landing, Map全部继承了Sprite，也就是继承了Sprite的方法。同时还分别有各自的动画实现逻辑。</p>
<h2 id="3-3-requestAnimationFrame-实现动画"><a href="#3-3-requestAnimationFrame-实现动画" class="headerlink" title="3.3 requestAnimationFrame 实现动画"></a>3.3 requestAnimationFrame 实现动画</h2><p>实现动画的原理利用 <code>drawImage()</code> 将图片画到 <code>Canvas</code> 指定的坐标画布上，实现动画就是利用<code>window.requestAnimationFrame</code> 实现动画循环：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">connectAnimation</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 计算每一帧动画的间隔时间</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getFrameTime</span>()</span><br><span class="line">    <span class="comment">// 每次进入清空画布</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">canvas</span>.<span class="property">width</span>, <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">canvas</span>.<span class="property">height</span>)</span><br><span class="line">    <span class="comment">// 实现动画的秘密就在这里，循环调用</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">connectAnimation</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>requestAnimationFrame</code> 解决了浏览器不知道javascript不知道最佳循环间隔时间的问题。</p>
<p>编写动画循环的关键，是要知道延迟时间多长合适。</p>
<p>一方面，循环时间必须足够短，这样才能保证动画效果更平滑流畅；另一方面，循环还要足够长，这样才能保证浏览器有能力渲染产生的变化。</p>
<p>大多数显示器的刷新频率是60Hz，相当于每秒钟重绘60次。大多数浏览器都会对重绘操作加以限制，不超过显示器的重绘频率，因为即使超过了这个频率，用户体验也不会有提升。</p>
<p>因此最平滑动画的最佳循环间隔是1000ms&#x2F;60，约等于17ms。以这个循环间隔重绘的动画是平滑的，因为这个速度最接近浏览器的最高限速。为了适应17ms的循环间隔，多重动画可能需要加以节制，以便不会完成得太快。</p>
<p>虽然与使用多组 <code>setTimeout()</code> 相比，使用 <code>setInterval()</code> 的动画循环效率更高。但是无论<code>setTimeout()</code> 还是 <code>setInterval()</code> 都不十分精确。为它们传入的第二个参数，实际上只是指定了把动画代码添加到浏览器UI线程队列以等待执行的时间。如果队列前面已经加入了其他任务，那动画代码就要等前面的任务执行完成后再执行。如果UI线程繁忙，比如忙于处理用户操作，那么即使把代码加入队列也不会立即执行。</p>
<p><strong>requestAnimationFrame的速度是由浏览器决定的，不同浏览器会自行决定最佳的帧效率。</strong></p>
<h1 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h1>
    </div>

    <div>全文完。</div>
  </article>
  <div class="toc-container">
    
  <div id="toc" class="toc-article">
    <strong class="toc-title">目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E8%83%8C%E6%99%AF"><span class="toc-text">一、背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-text">二、技术选型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%AE%9E%E7%8E%B0%E5%8A%A8%E7%94%BB%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-text">1、实现动画的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9Canvas"><span class="toc-text">2、为什么选择Canvas</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E9%9D%A2%E4%B8%B4%E7%9A%84%E6%8C%91%E6%88%98"><span class="toc-text">3、面临的挑战</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88"><span class="toc-text">三、实现方案</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%9B%BE%E7%89%87%E8%B5%84%E6%BA%90%E9%A2%84%E5%8A%A0%E8%BD%BD"><span class="toc-text">3.1 图片资源预加载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E5%8A%A0%E8%BD%BD"><span class="toc-text">预加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA"><span class="toc-text">执行时机</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%8A%A8%E7%94%BB%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1"><span class="toc-text">3.2 动画模块设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-requestAnimationFrame-%E5%AE%9E%E7%8E%B0%E5%8A%A8%E7%94%BB"><span class="toc-text">3.3 requestAnimationFrame 实现动画</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-text">四、总结</span></a></li></ol>
  </div>


  </div>
</div>
<div class="copyright">
    <span>转载时请注明原文链接。</span>
</div>
<!-- <div class="share" style="width: 100%;">
  <img src="https://kevinofneu-blog-static.oss-cn-beijing.aliyuncs.com/static/2018-12-10-qrcode_for_gh_ffacf5722095_258.jpg" alt="Running Geek" style="margin: auto; display: block;"/>

  <div style="margin: auto; text-align: center; font-size: 0.8em; color: grey;">老铁们关注走一走，不迷路</div>
  
</div>
 -->
  
    <div class="post-nav">
      <div class="post-nav-item post-nav-next">
        
          <span>〈 </span>
          <a href="/2019/10/28/the-story-of-vue3-0/" rel="next" title="Vue.js作者：聊聊关于Vue3.0的故事">
          Vue.js作者：聊聊关于Vue3.0的故事
          </a>
        
      </div>
  
      <div class="post-nav-item post-nav-prev">
          
          <a href="/2019/12/23/about-vscode-vue-plugin-config/" rel="prev" title="在Vscode中配置Vue相应的插件">
            在Vscode中配置Vue相应的插件
          </a>
          <span>〉</span>
        
      </div>
    </div>
  

  <script src="https://unpkg.com/octomments/build/ocs.min.js"></script>
  <div id="octomments"></div>
  <script>
  Octomments({
    github: {
      owner: 'answer518',
      repo: 'answer518.github.io',
    },
    issueNumber: 1,
    renderer: [OctommentsRenderer, '#octomments']
  }).init();
  </script>



    </div>

    

  </div>
  <footer class="footer text-center">
    <div id="bottom-inner">
        <a class="bottom-item" href="https://answer518.github.io">首页</a> |
        <a class="bottom-item" href="https://juejin.im/user/5b3a28a1e51d45558a3f7255/posts" target="_blank">掘金专栏</a> |
        <a class="bottom-item" href="https://github.com/answer518" target="_blank">GitHub</a> |
        <a class="bottom-item" href="https://hexo.io" target="_blank">Powered by hexo</a>
        <!-- <a class="bottom-item" href="https://github.com/KevinOfNeu/hexo-theme-xoxo" target="_blank">Theme xoxo</a> -->
    </div>
</footer>
  

<script>
  (function(window, document, undefined) {

    var timer = null;

    function returnTop() {
      cancelAnimationFrame(timer);
      timer = requestAnimationFrame(function fn() {
        var oTop = document.body.scrollTop || document.documentElement.scrollTop;
        if (oTop > 0) {
          document.body.scrollTop = document.documentElement.scrollTop = oTop - 50;
          timer = requestAnimationFrame(fn);
        } else {
          cancelAnimationFrame(timer);
        }
      });
    }

    var hearts = [];
    window.requestAnimationFrame = (function() {
      return window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        function(callback) {
          setTimeout(callback, 1000 / 60);
        }
    })();
    init();

    function init() {
      css(".heart{z-index:9999;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: absolute;}.heart:after{top: -5px;}.heart:before{left: -5px;}");
      attachEvent();
      gameloop();
      addMenuEvent();
    }

    function gameloop() {
      for (var i = 0; i < hearts.length; i++) {
        if (hearts[i].alpha <= 0) {
          document.body.removeChild(hearts[i].el);
          hearts.splice(i, 1);
          continue;
        }
        hearts[i].y--;
        hearts[i].scale += 0.004;
        hearts[i].alpha -= 0.013;
        hearts[i].el.style.cssText = "left:" + hearts[i].x + "px;top:" + hearts[i].y + "px;opacity:" + hearts[i].alpha + ";transform:scale(" + hearts[i].scale + "," + hearts[i].scale + ") rotate(45deg);background:" + hearts[i].color;
      }
      requestAnimationFrame(gameloop);
    }

    /**
     * 给logo设置点击事件
     * 
     * - 回到顶部
     * - 出现爱心
     */
    function attachEvent() {
      var old = typeof window.onclick === "function" && window.onclick;
      var logo = document.getElementById("logo");
      if (logo) {
        logo.onclick = function(event) {
          returnTop();
          old && old();
          createHeart(event);
        }
      }
      
    }

    function createHeart(event) {
      var d = document.createElement("div");
      d.className = "heart";
      hearts.push({
        el: d,
        x: event.clientX - 5,
        y: event.clientY - 5,
        scale: 1,
        alpha: 1,
        color: randomColor()
      });
      document.body.appendChild(d);
    }

    function css(css) {
      var style = document.createElement("style");
      style.type = "text/css";
      try {
        style.appendChild(document.createTextNode(css));
      } catch (ex) {
        style.styleSheet.cssText = css;
      }
      document.getElementsByTagName('head')[0].appendChild(style);
    }

    function randomColor() {
      // return "rgb(" + (~~(Math.random() * 255)) + "," + (~~(Math.random() * 255)) + "," + (~~(Math.random() * 255)) + ")";
      return "#F44336";
    }

    function addMenuEvent() {
      var menu = document.getElementById('menu-main-post');
      if (menu) {
        var toc = document.getElementById('toc');
        if (toc) {
          menu.onclick = function() {
            if (toc) {
              if (toc.style.display == 'block') {
                toc.style.display = 'none';
              } else {
                toc.style.display = 'block';
              }
            }
          };
        } else {
          menu.style.display = 'none';
        }
      }
    }

  })(window, document);
</script>

  



</body>
</html>
